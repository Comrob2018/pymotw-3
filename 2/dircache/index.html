<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>dircache &#8211; Cache directory listings - Python Module of the Week</title>

<link rel="stylesheet" href="../_static/default.css" 
    type="text/css" />
<style>
    body {
        margin: 8px;
    }
    .highlight {
        background-color: white;
        border: 0;
    }
    .highlight pre {
        background-color: white;
    }
</style>

<link href="../_static/css/leaves.css" rel="stylesheet" type="text/css" />
<link rel="alternate" type="application/atom+xml"
      title="Doug Hellmann"
      href="http://feeds.feedburner.com/DougHellmann" />
<link rel="alternate" type="application/atom+xml"
      title="Doug Hellmann Project Releases"
      href="http://feeds.feedburner.com/DougHellmann-Releases" />
<link rel="alternate" type="application/atom+xml"
      title="Doug Hellmann Links"
      href="http://feeds.feedburner.com/DougHellmannLinkBlog" />



<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
      URL_ROOT:    '../',
      VERSION:     '1.133',
      COLLAPSE_MODINDEX: false,
      FILE_SUFFIX: '.html'
  };
</script>

<script type="text/javascript" src="../_static/jquery.js"></script>
<script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="contents" title="Global table of contents" href="../contents.html" />
    <link rel="index" title="Global index" href="../genindex.html" />
    <link rel="top" title="Python Module of the Week" href="../index.html" />
    <link rel="up" title="File and Directory Access" href="../file_access.html" />
    <link rel="next" title="Data Compression and Archiving" href="../compression.html" />
    <link rel="prev" title="shutil – High-level file operations." href="../shutil/index.html" />

<meta name="verify-v1" content="5saTcOa2HLac4V85yUg3SARfun1PqT5Upu7IR/6fpv4="/>
</head>
<body>
    
<div id="container">
    
<div id="header">
  <a href="/"><h1>PyMOTW</h1></a>
  <p></p>
</div>

<div id="sidebar_left_wrapper">

<div id="navigation"> 
	<ul id="navlist">
		<li><a href="../index.html">Home</a></li>
		<li><a href="https://doughellmann.com/" target="_">Blog</a></li>
		<li><a href="https://doughellmann.com/python-standard-library-by-example">The Book</a></li>
		<li><a href="../about.html">About</a></li>
		<li><a href="/2/genindex.html">Site Index</a></li>
	</ul>
</div>


  <div id="sidebar_left">
      <p>If you find this information useful, consider picking up a copy of my book,
      <i><a href="http://doughellmann.com/python-standard-library-by-example">The Python Standard Library By
      Example</a></i>.</p>
  </div>

</div>


<div id="sidebar">
  <h3>Page Contents</h3>
  <ul>
<li><a class="reference internal" href="#">dircache &#8211; Cache directory listings</a><ul>
<li><a class="reference internal" href="#listing-directory-contents">Listing Directory Contents</a></li>
<li><a class="reference internal" href="#annotated-listings">Annotated Listings</a></li>
</ul>
</li>
</ul>
    <h3>Navigation</h3>
      <p>
    <a href="../contents.html"><strong>Table of Contents</strong></a><br/>
    
          <a href="../shutil/index.html" title="previous chapter"><strong>Previous:</strong> shutil &#8211; High-level file operations.</a><br/>
          <a href="../compression.html" title="next chapter"><strong>Next:</strong> Data Compression and Archiving</a><br/>
      </p>
    
      <h3>This Page</h3>
      <p>
      <a href="../_sources/dircache/index.txt"
               rel="nofollow">Show Source</a>
      </p><h3>Examples</h3>

<p>The output from all the example programs from PyMOTW has been
generated with Python 2.7.8, unless otherwise noted. Some
of the features described here may not be available in earlier
versions of Python.</p>

<p>If you are looking for examples that work under Python 3, please
refer to the <a href="/3/">PyMOTW-3</a> section of the site.</p><p><a target="new" href="https://doughellmann.com/blog/the-python-3-standard-library-by-example/"><img src="../_static/images/py3-book-cover.jpg"><br>Now available for Python 3!</a></p>
<p><a target="new" href="https://doughellmann.com/blog/the-python-standard-library-by-example/"><img src="../_static/images/py2-book-cover.jpg"><br>Buy the book!</a></p>
</div>


<div id="content">

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../compression.html" title="Data Compression and Archiving"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../shutil/index.html" title="shutil – High-level file operations."
             accesskey="P">previous</a> |</li>
        <li><a href="../contents.html">PyMOTW</a> &raquo;</li>
          <li><a href="../file_access.html" accesskey="U">File and Directory Access</a> &raquo;</li> 
      </ul>
    </div>

  <div class="section" id="module-dircache">
<span id="dircache-cache-directory-listings"></span><h1>dircache &#8211; Cache directory listings<a class="headerlink" href="#module-dircache" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Purpose:</th><td class="field-body">Cache directory listings, updating when the modification time of a directory changes.</td>
</tr>
<tr class="field-even field"><th class="field-name">Available In:</th><td class="field-body">1.4 and later</td>
</tr>
</tbody>
</table>
<div class="section" id="listing-directory-contents">
<h2>Listing Directory Contents<a class="headerlink" href="#listing-directory-contents" title="Permalink to this headline">¶</a></h2>
<p>The main function in the <a class="reference internal" href="#module-dircache" title="dircache: Cache directory listings"><tt class="xref py py-mod docutils literal"><span class="pre">dircache</span></tt></a> API is <tt class="xref py py-func docutils literal"><span class="pre">listdir()</span></tt>, a
wrapper around <tt class="xref py py-func docutils literal"><span class="pre">os.listdir()</span></tt> that caches the results and returns
the same <tt class="xref py py-class docutils literal"><span class="pre">list</span></tt> each time it is called with a given path, unless the
modification date of the named directory changes.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">dircache</span>

<span class="n">path</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span>
<span class="n">first</span> <span class="o">=</span> <span class="n">dircache</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">second</span> <span class="o">=</span> <span class="n">dircache</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&#39;Contents :&#39;</span><span class="p">,</span> <span class="n">first</span>
<span class="k">print</span> <span class="s">&#39;Identical:&#39;</span><span class="p">,</span> <span class="n">first</span> <span class="ow">is</span> <span class="n">second</span>
<span class="k">print</span> <span class="s">&#39;Equal    :&#39;</span><span class="p">,</span> <span class="n">first</span> <span class="o">==</span> <span class="n">second</span>
</pre></div>
</div>
<p>It is important to recognize that the exact same <tt class="xref py py-class docutils literal"><span class="pre">list</span></tt> is
returned each time, so it should not be modified in place.</p>
<div class="highlight-python"><div class="highlight"><pre>$ python dircache_listdir.py

Contents : [&#39;__init__.py&#39;, &#39;dircache_annotate.py&#39;, &#39;dircache_listdir.py&#39;, &#39;dircache_listdir_file_added.py&#39;, &#39;dircache_reset.py&#39;, &#39;index.rst&#39;]
Identical: True
Equal    : True
</pre></div>
</div>
<p>If the contents of the directory changes, it is rescanned.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">dircache</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">path</span> <span class="o">=</span> <span class="s">&#39;/tmp&#39;</span>
<span class="n">file_to_create</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;pymotw_tmp.txt&#39;</span><span class="p">)</span>

<span class="c"># Look at the directory contents</span>
<span class="n">first</span> <span class="o">=</span> <span class="n">dircache</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c"># Create the new file</span>
<span class="nb">open</span><span class="p">(</span><span class="n">file_to_create</span><span class="p">,</span> <span class="s">&#39;wt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># Rescan the directory</span>
<span class="n">second</span> <span class="o">=</span> <span class="n">dircache</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c"># Remove the file we created</span>
<span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">file_to_create</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&#39;Identical :&#39;</span><span class="p">,</span> <span class="n">first</span> <span class="ow">is</span> <span class="n">second</span>
<span class="k">print</span> <span class="s">&#39;Equal     :&#39;</span><span class="p">,</span> <span class="n">first</span> <span class="o">==</span> <span class="n">second</span>
<span class="k">print</span> <span class="s">&#39;Difference:&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">second</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">first</span><span class="p">))</span>
</pre></div>
</div>
<p>In this case the new file causes a new <tt class="xref py py-class docutils literal"><span class="pre">list</span></tt> to be
constructed.</p>
<div class="highlight-python"><div class="highlight"><pre>$ python dircache_listdir_file_added.py

Identical : False
Equal     : False
Difference: [&#39;pymotw_tmp.txt&#39;]
</pre></div>
</div>
<p>It is also possible to reset the entire cache, discarding its contents so that
each path will be rechecked.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">dircache</span>

<span class="n">path</span> <span class="o">=</span> <span class="s">&#39;/tmp&#39;</span>
<span class="n">first</span> <span class="o">=</span> <span class="n">dircache</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">dircache</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">second</span> <span class="o">=</span> <span class="n">dircache</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&#39;Identical :&#39;</span><span class="p">,</span> <span class="n">first</span> <span class="ow">is</span> <span class="n">second</span>
<span class="k">print</span> <span class="s">&#39;Equal     :&#39;</span><span class="p">,</span> <span class="n">first</span> <span class="o">==</span> <span class="n">second</span>
<span class="k">print</span> <span class="s">&#39;Difference:&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">second</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">first</span><span class="p">))</span>
</pre></div>
</div>
<p>After resetting, a new <tt class="xref py py-class docutils literal"><span class="pre">list</span></tt> instance is returned.</p>
<div class="highlight-python"><div class="highlight"><pre>$ python dircache_reset.py

Identical : False
Equal     : True
Difference: []
</pre></div>
</div>
</div>
<div class="section" id="annotated-listings">
<h2>Annotated Listings<a class="headerlink" href="#annotated-listings" title="Permalink to this headline">¶</a></h2>
<p>The other interesting function provided by the dircache module is
<tt class="xref py py-func docutils literal"><span class="pre">annotate()</span></tt>.  When called, <tt class="xref py py-func docutils literal"><span class="pre">annotate()</span></tt> modifies a
<tt class="xref py py-func docutils literal"><span class="pre">list()</span></tt> such as is returned by <tt class="xref py py-func docutils literal"><span class="pre">listdir()</span></tt>, adding a <tt class="docutils literal"><span class="pre">'/'</span></tt>
to the end of the names that represent directories.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">dircache</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">path</span> <span class="o">=</span> <span class="s">&#39;../..&#39;</span>

<span class="n">contents</span> <span class="o">=</span> <span class="n">dircache</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="n">annotated</span> <span class="o">=</span> <span class="n">contents</span><span class="p">[:]</span>
<span class="n">dircache</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">annotated</span><span class="p">)</span>

<span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%25s</span><span class="se">\t</span><span class="si">%25s</span><span class="s">&#39;</span>

<span class="k">print</span> <span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;ORIGINAL&#39;</span><span class="p">,</span> <span class="s">&#39;ANNOTATED&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">fmt</span> <span class="o">%</span> <span class="p">((</span><span class="s">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">25</span><span class="p">,)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">annotated</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<p>Unfortunately for Windows users, although <tt class="xref py py-func docutils literal"><span class="pre">annotate()</span></tt> uses
<tt class="xref py py-func docutils literal"><span class="pre">os.path.join()</span></tt> to construct names to test, it always appends a
<tt class="docutils literal"><span class="pre">'/'</span></tt>, not <tt class="xref py py-data docutils literal"><span class="pre">os.sep</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre>$ python dircache_annotate.py

                 ORIGINAL                       ANNOTATED
-------------------------       -------------------------
                      .hg                            .hg/
                 .hgcheck                       .hgcheck/
                .hgignore                       .hgignore
                  .hgtags                         .hgtags
              LICENSE.txt                     LICENSE.txt
              MANIFEST.in                     MANIFEST.in
                   PyMOTW                         PyMOTW/
          PyMOTW.egg-info                PyMOTW.egg-info/
               README.txt                      README.txt
                      bin                            bin/
                     dist                           dist/
                   module                          module
                     motw                            motw
              pavement.py                     pavement.py
             pavement.py~                    pavement.py~
        paver-minilib.zip               paver-minilib.zip
                 setup.py                        setup.py
   sitemap_gen_config.xml          sitemap_gen_config.xml
  sitemap_gen_config.xml~         sitemap_gen_config.xml~
                   sphinx                         sphinx/
                    utils                          utils/
                      web                            web/
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://docs.python.org/2.7/library/dircache.html">dircache</a></dt>
<dd>The standard library documentation for this module.</dd>
</dl>
</div>
</div>
</div>


    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../compression.html" title="Data Compression and Archiving"
             >next</a> |</li>
        <li class="right" >
          <a href="../shutil/index.html" title="shutil – High-level file operations."
             >previous</a> |</li>
        <li><a href="../contents.html">PyMOTW</a> &raquo;</li>
          <li><a href="../file_access.html" >File and Directory Access</a> &raquo;</li> 
      </ul>
    </div>


</div>

<div id="footer">
 
<p>
    &copy; Copyright <a rel="author" href="../about.html">Doug Hellmann</a>.
    | <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/us/" rel="license"><img alt="Creative Commons License" style="border-width:0; align: center;" width="80" height="15" src="http://i.creativecommons.org/l/by-nc-sa/3.0/us/80x15.png"/></a>
    | Last updated on Jul 11, 2020.
   | Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
   | Design based on "Leaves" by <a href="http://smallpark.org">SmallPark</a>
   | <a href="http://www.dreamhost.com/r.cgi?1246820/green.cgi?pymotw.com">
<img border="0" alt="Green Web Hosting! This site hosted by DreamHost."
src="https://secure.newdream.net/green4.gif" height="15" width="80" /></a></p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-38546875-1', 'pymotw.com');
  ga('send', 'pageview');

</script>


</div>

</div>

</body>
</html>